# APNs(Apple Push Notification service) ê°œë°œ ë¬¸ì„œ

*Mentory í”„ë¡œì íŠ¸ìš©* 

---

## ðŸ“Œ 1. APNsëž€ ë¬´ì—‡ì¸ê°€?

- *APNs(Apple Push Notification service)**ëŠ”

Appleì´ ì œê³µí•˜ëŠ” **í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡ ì„œë¹„ìŠ¤**ë¡œ,

ì„œë²„ì—ì„œ iOS ê¸°ê¸°ì˜ ì•±ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ëŠ” ê°€ìž¥ ê³µì‹ì ì´ê³  ìœ ì¼í•œ ë°©ë²•ì´ë‹¤.

ì¦‰,

> "ìš°ë¦¬ ì„œë²„ê°€ ì‚¬ìš©ìžì—ê²Œ ì•Œë¦¼ì„ ë³´ë‚´ê³  ì‹¶ì„ ë•Œ Appleì´ ëŒ€ì‹  ì „ë‹¬í•´ ì£¼ëŠ” ì„œë¹„ìŠ¤"
> 

ë¼ê³  ì´í•´í•˜ë©´ ê°€ìž¥ ì‰½ë‹¤.

Mentoryì—ì„œëŠ” ì‚¬ìš©ìžê°€ ì§€ì •í•œ ì•Œë¦¼ ì‹œê°„ì—

ì„œë²„ê°€ APNsë¥¼ í†µí•´ ê°ì • ê¸°ë¡ ë¦¬ë§ˆì¸ë” ì•Œë¦¼ì„ ë³´ë‚´ëŠ” êµ¬ì¡°ë¥¼ ì‚¬ìš©í•œë‹¤.

---

## ðŸ“Œ 2. APNsê°€ í•„ìš”í•œ ì´ìœ 

ë¡œì»¬ ì•Œë¦¼(Local Notification)ì€ ì•± ë‚´ë¶€ì—ì„œ ìžì²´ì ìœ¼ë¡œ ì˜ˆì•½í•˜ëŠ” ë°©ì‹ì´ë‹¤.

í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” ë‹¤ìŒ ì´ìœ ë¡œ **APNs ê¸°ë°˜ ì„œë²„ ì•Œë¦¼**ì„ ì„ íƒí•œë‹¤:

- ì‚¬ìš©ìžê°€ **ì•±ì„ ì‚­ì œí•˜ê±°ë‚˜ ê¸°ê¸° ë³€ê²½**í•´ë„ ì„œë²„ì—ì„œ ê´€ë¦¬ ê°€ëŠ¥
- ì‚¬ìš©ìž ë§žì¶¤ ë©”ì‹œì§€, ë¶„ì„ ê²°ê³¼ ì—°ë™ ë“± **ë™ì  ë©”ì‹œì§€** ì „ë‹¬ ê°€ëŠ¥
- í–¥í›„ ë¨¸ì‹ ëŸ¬ë‹, ì‚¬ìš©ìž ìƒíƒœ ê¸°ë°˜ ì•Œë¦¼ í™•ìž¥ì—ë„ ìœ ë¦¬
- iOSì˜ ë°±ê·¸ë¼ìš´ë“œ ì œí•œì„ ë°›ì§€ ì•ŠìŒ
- ì•Œë¦¼ ì‹¤íŒ¨/ì„±ê³µì„ ì„œë²„ì—ì„œ ì¶”ì í•  ìˆ˜ ìžˆìŒ

---

## ðŸ“Œ 3. APNs ë™ìž‘ íë¦„ (Mentory ê¸°ì¤€)

```
1. iOS ì•±ì´ APNsì— â€œí‘¸ì‹œ í† í°(ê¸°ê¸° í† í°)â€ì„ ìš”ì²­
2. APNsê°€ ê¸°ê¸° ê³ ìœ  í† í°(Device Token)ì„ ì•±ì—ê²Œ ì œê³µ
3. ì•±ì€ í•´ë‹¹ í† í°ì„ ìš°ë¦¬ ì„œë²„ë¡œ ì „ì†¡
4. ì•Œë¦¼ ì‹œê°„ì´ ë˜ë©´ ì„œë²„ì—ì„œ APNsë¡œ ì•Œë¦¼ ìš”ì²­ì„ ë³´ëƒ„
5. APNsê°€ í•´ë‹¹ ê¸°ê¸°ë¡œ ì•Œë¦¼ ì „ë‹¬
6. ì‚¬ìš©ìžê°€ Mentory ì•Œë¦¼ì„ ìˆ˜ì‹ í•¨

```

ì´ ì¤‘ ê°œë°œìžê°€ ì‹¤ì œë¡œ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ë‹¨ê³„ëŠ”:

- iOS ì•± â†’ Device Token ë°›ê¸°
- Device Token â†’ ì„œë²„ë¡œ ì €ìž¥
- ì„œë²„ì—ì„œ APNsì— ì•Œë¦¼ ìš”ì²­ API í˜¸ì¶œ

---

## ðŸ“Œ 4. í•„ìˆ˜ ê°œë… ì •ë¦¬

### ðŸ”‘ Device Token

- APNsê°€ íŠ¹ì • ê¸°ê¸°ë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•œ ê³ ìœ  ê°’
- ì•± ì„¤ì¹˜/ìž¬ì„¤ì¹˜ ë˜ëŠ” ê¸°ê¸° ë³€ê²½ ì‹œ ë³€ê²½ë  ìˆ˜ ìžˆìŒ
- ì•±ì—ì„œ ì„œë²„ë¡œ ê³„ì† ìµœì‹  í† í°ì„ ë³´ë‚´ì£¼ì–´ì•¼ í•¨

### ðŸ” ì¸ì¦ ë°©ì‹ (Server â†’ APNs)

ì„œë²„ê°€ ì•Œë¦¼ì„ ë³´ë‚¼ ë•Œ ì¸ì¦ì— ë‘ ê°€ì§€ ë°©ì‹ì´ ìžˆìŒ:

| ë°©ì‹ | ì„¤ëª… | ìž¥ì  | ë‹¨ì  |
| --- | --- | --- | --- |
| **Auth Key (ì¶”ì²œ)** | .p8 íŒŒì¼ ê¸°ë°˜ JWT í† í° ì¸ì¦ | ì‰½ê³  ìœ ì§€ê´€ë¦¬ íŽ¸í•¨ | ì—†ìŒ |
| Certificate | .pem ì¸ì¦ì„œ ë°©ì‹ | ê¸°ì¡´ ë°©ì‹ | ê°±ì‹  í•„ìš” |

ëŒ€ë¶€ë¶„ ìµœì‹  ì„œë²„ì—ì„œëŠ” **Auth Key(.p8)** ë°©ì‹ ì‚¬ìš©.

Mentoryë„ ì´ ë°©ì‹ìœ¼ë¡œ ì„¤ê³„í•˜ë©´ ì¢‹ìŒ.

---

## ðŸ“Œ 5. APNs êµ¬ì„±(Development Portal)

### 1) Developer ê³„ì •ì—ì„œ í•„ìš”í•œ ìž‘ì—…

- Team Agent ê³„ì • í•„ìš”
- App Identifierì—ì„œ â€œPush Notificationsâ€ í™œì„±í™”
- **Key â†’ APNs Auth Key ìƒì„±(.p8 ë‹¤ìš´ë¡œë“œ)**
- Key ID, Team ID, Bundle ID ì €ìž¥

### 2) Xcodeì—ì„œ ì„¤ì •

- Signing & Capabilitiesì—ì„œ Push Notifications ì¼œê¸°
- Background Modes â†’ Remote Notifications í™œì„±í™”(ì„ íƒ)

---

## ðŸ“Œ 6. iOS ì•± êµ¬í˜„ ë‹¨ê³„

### ðŸ“˜ 1) ì•Œë¦¼ ê¶Œí•œ ìš”ì²­

```swift
import UserNotifications

func requestNotificationPermission() {
    UNUserNotificationCenter.current().requestAuthorization(options: [.alert, .sound, .badge]) { granted, error in
        if granted {
            print("ì•Œë¦¼ ê¶Œí•œ í—ˆìš©ë¨")
        } else {
            print("ì•Œë¦¼ ê¶Œí•œ ê±°ë¶€ë¨")
        }
    }
}

```

ì•± ì‹¤í–‰ ì‹œ ë˜ëŠ” ì„¤ì • í™”ë©´ì—ì„œ í˜¸ì¶œ.

---

### ðŸ“˜ 2) APNsì— Device Token ìš”ì²­

```swift
import UIKit

@main
class AppDelegate: UIResponder, UIApplicationDelegate {
    func application(_ application: UIApplication,
                    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey : Any]? = nil) -> Bool {

        // APNs ë“±ë¡ ìš”ì²­
        UIApplication.shared.registerForRemoteNotifications()
        return true
    }

    // ê¸°ê¸° í† í° ìˆ˜ì‹ 
    func application(_ application: UIApplication,
                    didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {

        let tokenString = deviceToken.map { String(format: "%02.2hhx", $0) }.joined()
        print("ðŸ“± Device Token:", tokenString)

        // ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ë¡œì§ í•„ìš”
    }
}

```

SwiftUI App ìƒëª…ì£¼ê¸°ë¥¼ ì“°ëŠ” ê²½ìš°ë„ AppDelegate ì—°ê²°ë¡œ ë™ì¼í•˜ê²Œ êµ¬í˜„ ê°€ëŠ¥.

---

### ðŸ“˜ 3) ì„œë²„ë¡œ Device Token ì „ì†¡

í† í°ì„ ì„œë²„ì—ì„œ ì €ìž¥í•´ì•¼ íŠ¹ì • ì‚¬ìš©ìžì—ê²Œ ì•Œë¦¼ì„ ë³´ë‚¼ ìˆ˜ ìžˆìŒ.

ì˜ˆì‹œ(JSON):

```json
{
  "userId": "1234",
  "deviceToken": "xxxxx..."
}

```

---

## ðŸ“Œ 7. ì„œë²„ì—ì„œ ì•Œë¦¼ ë³´ë‚´ëŠ” ë°©ì‹(APNs HTTP/2 API)

### HTTP Request ì˜ˆì‹œ (Auth Key ê¸°ë°˜)

```
POST https://api.push.apple.com/3/device/{deviceToken}
Authorization: bearer {JWT}
apns-topic: {Bundle ID}
Content-Type: application/json

{
  "aps": {
    "alert": {
      "title": "ì˜¤ëŠ˜ì€ ì–´ë–¤ í•˜ë£¨ì˜€ë‚˜ìš”?",
      "body": "ì§€ê¸ˆ ê°ì • ê¸°ë¡ì„ ë‚¨ê²¨ë³´ëŠ” ê±´ ì–´ë•Œìš”?"
    },
    "sound": "default"
  }
}

```

Mentoryì—ì„œëŠ”

â€œì„¤ì •í•œ ì•Œë¦¼ ì‹œê°„ë§ˆë‹¤ ì„œë²„ì—ì„œ ìœ„ APIë¥¼ í˜¸ì¶œâ€

í•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í•˜ë©´ ëœë‹¤.

---

## ðŸ“Œ 8. Mentoryì—ì„œ APNsê°€ ì–´ë–»ê²Œ ì‚¬ìš©ë  ì˜ˆì •ì¸ê°€?

### ðŸ”” ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

1. ì‚¬ìš©ìžê°€ ì„¤ì • í™”ë©´ì—ì„œ â€œì•Œë¦¼ ì‹œê°„â€ì„ ì •í•¨
2. ì•±ì´ ì„œë²„ë¡œ ì•Œë¦¼ ì‹œê°„ + ì‚¬ìš©ìž Device Token ì „ë‹¬
3. ì„œë²„ëŠ” ìŠ¤ì¼€ì¤„ëŸ¬(Cron ë“±)ë¡œ ì•Œë¦¼ ì‹œê°„ì„ ì²´í¬
4. í•´ë‹¹ ì‹œê°ì— APNs APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì•Œë¦¼ ë°œì†¡
5. ì‚¬ìš©ìžì—ê²Œ ê°ì • ê¸°ë¡ ë¦¬ë§ˆì¸ë” ë„ì°©

### ðŸ”” APNsë¡œ ë³´ë‚´ëŠ” ì•Œë¦¼ì˜ íŠ¹ì§•

- ì•±ì´ ì‹¤í–‰ ì¤‘ì´ ì•„ë‹ˆì–´ë„ ë„ì°© ê°€ëŠ¥
- ì¸í„°ë„· ì—°ê²° í•„ìš”
- ë©”ì‹œì§€ ì»¤ìŠ¤í…€ ê°€ëŠ¥
- ë‹¤êµ­ì–´ ì„¤ì • ê°€ëŠ¥
- í–¥í›„ â€œAI ë¶„ì„ ê¸°ë°˜ ì•Œë¦¼â€ ê°™ì€ ê¸°ëŠ¥ í™•ìž¥ì— ìœ ë¦¬

---

## ðŸ“Œ 9. ê°œë°œ ì¤‘ ì£¼ì˜ì‚¬í•­

### â— 1) Device Tokenì€ ìžì£¼ ë°”ë€” ìˆ˜ ìžˆìŒ

- ì•± ìž¬ì„¤ì¹˜
- iOS ì—…ë°ì´íŠ¸
- ë°±ì—… ë³µì›

â†’ ì•± ì‹¤í–‰ ë•Œ tokenì´ ë°”ë€” ê°€ëŠ¥ì„±ì´ ìžˆì–´

**í•­ìƒ ì„œë²„ë¡œ ìµœì‹  í† í°ì„ ë™ê¸°í™”**í•´ì•¼ í•¨.

---

### â— 2) í‘¸ì‹œ ê¶Œí•œì„ ì‚¬ìš©ìžê°€ êº¼ë²„ë¦¬ë©´ ì•Œë¦¼ ì•ˆ ì˜´

â†’ ì„¤ì • ì•±ì—ì„œ ë‹¤ì‹œ ì¼œë‹¬ë¼ê³  ì•ˆë‚´ í•„ìš”

---

### â— 3) Debug / Release í™˜ê²½ í† í° ë‹¤ë¦„

- Sandbox(ê°œë°œ)
- Production(ë°°í¬)

ì„œë²„ ì„¤ì •ë„ ë‘ ê°œë¥¼ êµ¬ë¶„í•´ì•¼ í•¨.

---

### â— 4) iOSëŠ” ì•Œë¦¼ì„ ì§€ë‚˜ì¹˜ê²Œ ë§Žì´ ë³´ë‚´ë©´ ì‚¬ìš©ìž ê²½í—˜ ì €í•˜

Mentoryì—ì„œëŠ” â€œí•˜ë£¨ 1~2íšŒâ€ ì •ë„ê°€ ì ë‹¹.

---

## ðŸ“Œ 10. í…ŒìŠ¤íŠ¸ ë°©ë²•

1. Xcode â†’ device logsì—ì„œ í† í° í™•ì¸
2. curlë¡œ ì§ì ‘ APNs API í˜¸ì¶œ ê°€ëŠ¥

(ë‹¨, JWT ìƒì„±ì´ í•„ìš”í•¨)

---

## ðŸ“Œ 11. ì°¸ê³  ìžë£Œ

- Apple Official Docs
    - https://developer.apple.com/documentation/usernotifications
    - https://developer.apple.com/documentation/usernotifications/registering_your_app_with_apns
    - https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server

---

# ðŸ“¦ ìµœì¢… ìš”ì•½

> APNsëŠ” iOS í‘¸ì‹œ ì•Œë¦¼ì„ ì „ë‹¬í•˜ëŠ” Appleì˜ ê³µì‹ ì„œë¹„ìŠ¤
> 
> 
> MentoryëŠ” â€œì‚¬ìš©ìžê°€ ì •í•œ ì•Œë¦¼ ì‹œê°„ â†’ ì„œë²„ â†’ APNs â†’ ê¸°ê¸°â€ íë¦„ìœ¼ë¡œ ì•Œë¦¼ì„ ë³´ëƒ„
> 
> ì•±ì—ì„œëŠ” Device Token ë°›ê¸° + ì„œë²„ë¡œ ì „ë‹¬ ê¸°ëŠ¥ë§Œ êµ¬í˜„í•˜ë©´ ë¨
> 
> ì„œë²„ì—ì„œëŠ” APNs HTTP/2 APIë¥¼ ì´ìš©í•´ ì•Œë¦¼ì„ ë°œì†¡í•˜ë©´ ë¨
>

